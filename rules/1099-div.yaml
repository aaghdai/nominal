# IRS Form 1099-DIV - Dividends and Distributions
form_name: 1099-DIV
description: IRS Form 1099-DIV - Dividends and Distributions

variables:
  global:
    - FULL_NAME          # Recipient name (consolidated from RECIPIENT_NAME)
    - TIN_LAST_FOUR      # Last four digits of TIN/SSN
  local:
    - FORM_NAME

criteria:
  # Document must contain "1099-DIV" or "1099 DIV" text
  - type: regex
    pattern: '(?i)1099[\s-]?DIV'
    description: "Document must contain '1099-DIV' or '1099 DIV'"

  # Must have recipient TIN/SSN pattern - use any to be flexible
  - type: any
    criteria:
      # Pattern 1: RECIPIENTS TIN followed by SSN/TIN pattern
      - type: regex
        pattern: 'RECIPIENTS?\s+TIN.*?(\d{3}-\d{2}-\d{4}|\d{4})'
        description: "Recipient's TIN (SSN format or last 4 digits) near RECIPIENTS TIN"

      # Pattern 2: SSN/TIN pattern anywhere (will be extracted in actions)
      - type: regex
        pattern: '\b\d{3}-\d{2}-\d{4}\b|\b\d{4}\b'
        description: "Contains SSN/TIN pattern (full or last 4 digits)"

actions:
  # Set form name
  - type: set
    variable: FORM_NAME
    value: "1099-DIV"

  # Extract TIN_LAST_FOUR from full SSN pattern (extract last 4 digits from RECIPIENTS TIN)
  - type: regex_extract
    variable: TIN_LAST_FOUR
    from_text: true
    pattern: 'RECIPIENTS?\s+TIN.*?\d{3}-\d{2}-(\d{4})'
    group: 1
    required: false

  # Alternative: Extract TIN_LAST_FOUR from SSN pattern after PAYERS TIN
  - type: regex_extract
    variable: TIN_LAST_FOUR
    from_text: true
    pattern: 'PAYERS\s+TIN\s+RECIPIENTS?\s+TIN.*?\d{3}-\d{2}-(\d{4})'
    group: 1
    required: false

  # Fallback: Extract TIN_LAST_FOUR from any full SSN pattern
  - type: regex_extract
    variable: TIN_LAST_FOUR
    from_text: true
    pattern: '\b\d{3}-\d{2}-(\d{4})\b'
    group: 1
    required: false

  # Extract recipient name from RECIPIENTS name section
  - type: regex_extract
    variable: FULL_NAME
    from_text: true
    pattern: 'RECIPIENTS?\s+name[^:]*:\s*([A-Z][A-Z\s]+?)(?:\s+street|\s+\(|$)'
    group: 1
    required: false

  # Alternative: Extract name from address line
  - type: regex_extract
    variable: FULL_NAME
    from_text: true
    pattern: '^([A-Z][A-Z\s]{2,30}?)\s+(?:street|address|St|Ave|Rd|Blvd|Ln|Dr)'
    group: 1
    required: false

  # Extract TIN_LAST_FOUR directly if only last 4 digits are shown (without full SSN)
  - type: regex_extract
    variable: TIN_LAST_FOUR
    from_text: true
    pattern: '(?:TIN|SSN|Social Security).*?(\d{4})(?!\d)'
    group: 1
    required: false
