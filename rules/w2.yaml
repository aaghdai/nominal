# IRS Form W-2 - Wage and Tax Statement
form_name: W2
description: IRS Form W-2 - Wage and Tax Statement

variables:
  global:
    - FIRST_NAME
    - LAST_NAME
    - FULL_NAME  # Alternative to FIRST_NAME/LAST_NAME
    - TIN_LAST_FOUR  # Last four digits of TIN/SSN
  local:
    - FORM_NAME

criteria:
  # Document must contain "w-2" or "w2" text
  - type: regex
    pattern: '(?i)w-?2'
    description: "Document must contain W-2 or W2"

  # At least one of the following should be true
  - type: any
    criteria:
      # Has TIN/SSN pattern (full or last 4 digits)
      - type: regex
        pattern: '\b\d{3}-\d{2}-\d{4}\b|XXX-XX-\d{4}|\b\d{4}\b'
        description: "TIN/SSN pattern (full or last 4 digits)"

      # Has wage/tax keywords
      - type: regex
        pattern: '(?i)(wage|tax|statement|employer|employee)'
        description: "Contains wage or tax related keywords"

actions:
  # Set form name
  - type: set
    variable: FORM_NAME
    value: "W2"

  # Extract TIN_LAST_FOUR from full SSN pattern (extract last 4 digits)
  - type: regex_extract
    variable: TIN_LAST_FOUR
    from_text: true
    pattern: '\b\d{3}-\d{2}-(\d{4})\b'
    group: 1
    required: false

  # Extract TIN_LAST_FOUR directly if only last 4 digits are shown
  - type: regex_extract
    variable: TIN_LAST_FOUR
    from_text: true
    pattern: '(?:SSN|Social Security|TIN).*?(\d{4})(?!\d)'
    group: 1
    required: false

  # Try to extract name (uppercase format like in real W2s)
  - type: regex_extract
    variable: FULL_NAME
    from_text: true
    pattern: '\b([A-Z]+\s+[A-Z]+\s+[A-Z]+)\s+\d+'
    group: 1

  # Try to extract name (mixed case format)
  - type: regex_extract
    variable: FIRST_NAME
    from_text: true
    pattern: '(?:Employee.*?name|name).*?:\s*([A-Z][a-z]+)'
    group: 1

  - type: regex_extract
    variable: LAST_NAME
    from_text: true
    pattern: '(?:Employee.*?name|name).*?:\s*[A-Z][a-z]+\s+([A-Z][a-z]+)'
    group: 1
