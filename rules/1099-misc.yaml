# IRS Form 1099-MISC - Miscellaneous Income
form_name: 1099-MISC
description: IRS Form 1099-MISC - Miscellaneous Income

variables:
  global:
    - FULL_NAME          # Recipient name (consolidated from RECIPIENT_NAME)
    - TIN_LAST_FOUR      # Last four digits of TIN/SSN
  local:
    - FORM_NAME

criteria:
  # Document must contain "1099" text
  - type: contains
    value: "1099"
    case_sensitive: false
    description: "Document must contain '1099'"

  # Must have TIN/SSN pattern (full or last 4 digits)
  - type: regex
    pattern: '\b\d{3}-\d{2}-\d{4}\b|\b\d{2}-\d{7}\b|\b\d{4}\b'
    description: "Recipient's TIN (SSN, EIN, or last 4 digits format)"

  # Must have recipient name (simplified pattern)
  - type: regex
    pattern: 'Recipient.*?:\s*([A-Z][a-zA-Z\s]+)'
    capture: true
    variable: FULL_NAME
    description: "Capture recipient name"

actions:
  # Set form name
  - type: set
    variable: FORM_NAME
    value: "1099-MISC"

  # Extract TIN_LAST_FOUR from full SSN pattern (extract last 4 digits)
  - type: regex_extract
    variable: TIN_LAST_FOUR
    from_text: true
    pattern: '\b\d{3}-\d{2}-(\d{4})\b'
    group: 1
    required: false

  # Extract TIN_LAST_FOUR directly if only last 4 digits are shown (without full SSN)
  - type: regex_extract
    variable: TIN_LAST_FOUR
    from_text: true
    pattern: '(?:TIN|SSN|Social Security).*?(\d{4})(?!\d)'
    group: 1
    required: false
